@model IEnumerable<SchoolEduERP.Models.Domain.ClassSection>
@{
    ViewData["Title"] = "Class Sections";
    var enrollmentCounts = ViewBag.EnrollmentCounts as Dictionary<int, int> ?? new Dictionary<int, int>();
}

<div class="flex justify-between items-center mb-6">
    <div>
        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Class &amp; Divisions</h1>
        <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">Manage Standards (1–12) and their Divisions (A, B, C…)</p>
    </div>
    <a asp-action="Create" class="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg shadow hover:bg-primary/90 transition-all">
        <span class="material-symbols-outlined !text-[18px]">add</span> Add Class
    </a>
</div>

<!-- Group by Standard -->
@{
    var grouped = Model
        .OrderBy(c => int.TryParse(c.ClassName, out var n) ? n : 99)
        .ThenBy(c => c.Section)
        .GroupBy(c => c.ClassName);
}

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    @foreach (var group in grouped)
    {
        <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700/50 overflow-hidden">
            <div class="px-6 py-4 bg-slate-50 dark:bg-surface-dark-hover border-b border-slate-100 dark:border-slate-700 flex items-center justify-between">
                <h3 class="font-bold text-lg text-slate-800 dark:text-slate-100 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary !text-[20px]">class</span>
                    Std @group.Key
                </h3>
                <span class="text-xs text-slate-500 dark:text-slate-400 font-medium">@group.Count() divisions</span>
            </div>
            <div class="divide-y divide-slate-100 dark:divide-slate-700">
                @foreach (var cs in group)
                {
                    var count = enrollmentCounts.ContainsKey(cs.Id) ? enrollmentCounts[cs.Id] : 0;
                    var pct = cs.Capacity > 0 ? Math.Round((double)count / cs.Capacity * 100) : 0;
                    var barColor = pct > 90 ? "bg-red-500" : pct > 70 ? "bg-amber-500" : "bg-emerald-500";

                    <div class="px-6 py-4 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-surface-dark-hover transition-colors">
                        <div class="flex items-center gap-4">
                            <div class="size-10 rounded-xl bg-primary/10 text-primary flex items-center justify-center font-bold text-sm">
                                @cs.Section
                            </div>
                            <div>
                                <p class="font-semibold text-sm text-slate-900 dark:text-slate-100">Division @cs.Section</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <div class="h-1.5 w-16 bg-slate-200 dark:bg-slate-600 rounded-full overflow-hidden">
                                        <div class="h-full @barColor rounded-full" style="width: @(pct)%"></div>
                                    </div>
                                    <span class="text-xs text-slate-500 dark:text-slate-400">@count / @cs.Capacity</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <a asp-action="Edit" asp-route-id="@cs.Id" class="text-xs text-primary font-semibold hover:underline">Edit</a>
                            <form asp-action="Delete" method="post" class="inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@cs.Id" />
                                <button type="submit" onclick="return confirm('Delete Std @cs.ClassName - @cs.Section?')" class="text-xs text-red-600 font-semibold hover:underline">Delete</button>
                            </form>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>
