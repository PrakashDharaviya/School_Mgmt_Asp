@model ReportViewModel
@{ ViewData["Title"] = "Reports & Analytics"; ViewData["UserRole"] = "Admin"; }

<div class="flex flex-wrap justify-between items-end gap-4 mb-10">
    <div>
        <h1 class="text-3xl md:text-4xl font-black leading-tight tracking-[-0.033em] dark:text-white">Reports &amp; Analytics</h1>
        <p class="text-slate-500 dark:text-slate-400 text-base">Overview of Academic Year @Model.ActiveAcademicYear</p>
    </div>
</div>

<!-- Report Selector Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
    <div class="group relative flex flex-col gap-4 rounded-2xl bg-white dark:bg-surface-dark p-6 text-left shadow-sm ring-2 ring-primary ring-offset-2 dark:ring-offset-background-dark transition-all">
        <div class="flex items-center justify-between">
            <div class="rounded-xl bg-primary/10 p-3 text-primary"><span class="material-symbols-outlined text-[28px]">school</span></div>
            <span class="material-symbols-outlined text-primary text-[24px]">check_circle</span>
        </div>
        <div>
            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Student Performance</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">GPA &amp; Exam Scores</p>
        </div>
    </div>
    <div class="group flex flex-col gap-4 rounded-2xl bg-white dark:bg-surface-dark p-6 text-left shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all border border-transparent hover:border-slate-200 dark:hover:border-slate-600">
        <div class="rounded-xl bg-slate-100 dark:bg-slate-700 p-3 text-slate-600 dark:text-slate-300 w-fit group-hover:bg-emerald-100 group-hover:text-emerald-600 transition-colors">
            <span class="material-symbols-outlined text-[28px]">payments</span>
        </div>
        <div>
            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Fee Analytics</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Collections &amp; Dues</p>
        </div>
    </div>
    <div class="group flex flex-col gap-4 rounded-2xl bg-white dark:bg-surface-dark p-6 text-left shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all border border-transparent hover:border-slate-200 dark:hover:border-slate-600">
        <div class="rounded-xl bg-slate-100 dark:bg-slate-700 p-3 text-slate-600 dark:text-slate-300 w-fit group-hover:bg-purple-100 group-hover:text-purple-600 transition-colors">
            <span class="material-symbols-outlined text-[28px]">calendar_month</span>
        </div>
        <div>
            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Attendance Trends</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Daily &amp; Monthly Stats</p>
        </div>
    </div>
    <div class="group flex flex-col gap-4 rounded-2xl bg-white dark:bg-surface-dark p-6 text-left shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all border border-transparent hover:border-slate-200 dark:hover:border-slate-600">
        <div class="rounded-xl bg-slate-100 dark:bg-slate-700 p-3 text-slate-600 dark:text-slate-300 w-fit group-hover:bg-orange-100 group-hover:text-orange-600 transition-colors">
            <span class="material-symbols-outlined text-[28px]">assignment</span>
        </div>
        <div>
            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Exam Results</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Term &amp; Final Reports</p>
        </div>
    </div>
</div>

<!-- Main Stats Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
    <div class="bg-white dark:bg-surface-dark rounded-xl p-6 shadow-sm border border-slate-100 dark:border-slate-700">
        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium mb-1">Fee Collection Rate</p>
        <h3 class="text-3xl font-bold text-slate-900 dark:text-white">@Model.CollectionRate%</h3>
        <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-1.5 mt-3">
            <div class="bg-primary h-1.5 rounded-full" style="width: @Model.CollectionRate%"></div>
        </div>
    </div>
    <div class="bg-white dark:bg-surface-dark rounded-xl p-6 shadow-sm border border-slate-100 dark:border-slate-700">
        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium mb-1">Total Collected</p>
        <h3 class="text-3xl font-bold text-emerald-600">&#x20B9;@Model.TotalFeeCollected.ToString("N0")</h3>
    </div>
    <div class="bg-white dark:bg-surface-dark rounded-xl p-6 shadow-sm border border-slate-100 dark:border-slate-700">
        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium mb-1">Total Overdue</p>
        <h3 class="text-3xl font-bold text-red-600">&#x20B9;@Model.TotalFeeOverdue.ToString("N0")</h3>
    </div>
    <div class="bg-white dark:bg-surface-dark rounded-xl p-6 shadow-sm border border-slate-100 dark:border-slate-700">
        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium mb-1">Average GPA</p>
        <h3 class="text-3xl font-bold text-primary">@Model.AverageGpa</h3>
    </div>
</div>

<!-- Charts & GPA Distribution -->
<div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-10">
    <!-- Bar Chart Area (GPA Analysis) -->
    <div class="lg:col-span-8 flex flex-col bg-white dark:bg-surface-dark rounded-2xl p-8 shadow-sm border border-slate-100 dark:border-slate-700">
        <div class="flex items-center justify-between mb-8">
            <div>
                <h3 class="text-xl font-bold text-slate-900 dark:text-white">GPA Distribution</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400">Performance across all students</p>
            </div>
        </div>
        <div class="flex-1 w-full flex items-end justify-around gap-4 px-4 pb-4" style="min-height: 250px;">
            @foreach (var item in Model.GpaDistribution)
            {
                var maxCount = Model.GpaDistribution.Max(g => g.Count);
                var heightPct = maxCount > 0 ? (int)((double)item.Count / maxCount * 100) : 10;
                if (heightPct < 5) heightPct = 5;
                <div class="group relative flex flex-col items-center gap-3 w-full max-w-[120px]">
                    <div class="absolute -top-10 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-900 text-white text-xs font-bold py-1 px-2 rounded">@item.Count students</div>
                    <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-2xl relative overflow-hidden" style="height: 200px;">
                        <div class="absolute bottom-0 w-full bg-gradient-to-t from-primary/80 to-primary/50 transition-all duration-500 rounded-t-2xl group-hover:brightness-110" style="height: @heightPct%"></div>
                    </div>
                    <span class="text-xs font-semibold text-slate-600 dark:text-slate-300 text-center">@item.Range</span>
                </div>
            }
        </div>
    </div>

    <!-- Attendance Side -->
    <div class="lg:col-span-4 flex flex-col bg-white dark:bg-surface-dark rounded-2xl p-6 shadow-sm border border-slate-100 dark:border-slate-700">
        <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-6">Overall Attendance</h3>
        <div class="flex flex-col items-center gap-6 flex-1 justify-center">
            <div class="relative h-32 w-32 flex items-center justify-center">
                @{ var attPct = Model.OverallAttendanceRate; }
                <svg class="w-full h-full transform -rotate-90">
                    <circle class="text-slate-100 dark:text-slate-700" cx="64" cy="64" r="56" fill="transparent" stroke="currentColor" stroke-width="10"></circle>
                    <circle class="text-emerald-500" cx="64" cy="64" r="56" fill="transparent" stroke="currentColor" stroke-dasharray="351.9" stroke-dashoffset="@(351.9 * (1 - (double)attPct / 100))" stroke-width="10" stroke-linecap="round"></circle>
                </svg>
                <span class="absolute text-2xl font-black text-emerald-600">@attPct%</span>
            </div>
            <div class="grid grid-cols-2 gap-4 w-full">
                <div class="text-center bg-emerald-50 p-3 rounded-lg">
                    <p class="text-xs text-emerald-600 font-bold uppercase">Present</p>
                    <p class="text-lg font-bold text-emerald-700">@Model.TotalPresentToday</p>
                </div>
                <div class="text-center bg-red-50 p-3 rounded-lg">
                    <p class="text-xs text-red-600 font-bold uppercase">Absent</p>
                    <p class="text-lg font-bold text-red-700">@Model.TotalAbsentToday</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- PDF Report Downloads -->
<div class="bg-white dark:bg-surface-dark rounded-2xl p-8 shadow-sm border border-slate-100 dark:border-slate-700">
    <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Download Reports (PDF)</h3>
    <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Generate and download printable PDF reports for each class/exam.</p>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <a asp-area="" asp-controller="ReportDownload" asp-action="AttendanceReport" asp-route-classSectionId="1" asp-route-month="@DateTime.UtcNow.Month" asp-route-year="@DateTime.UtcNow.Year"
           class="flex items-center gap-3 p-4 rounded-xl border border-slate-200 hover:border-primary/30 hover:shadow-md transition-all group">
            <div class="size-10 rounded-lg bg-emerald-50 text-emerald-600 flex items-center justify-center group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined">event_available</span>
            </div>
            <div>
                <p class="font-bold text-sm text-slate-900 dark:text-white">Attendance &#8212; X-A</p>
                <p class="text-xs text-slate-500 dark:text-slate-400">Current month PDF</p>
            </div>
        </a>
        <a asp-area="" asp-controller="ReportDownload" asp-action="AttendanceReport" asp-route-classSectionId="2" asp-route-month="@DateTime.UtcNow.Month" asp-route-year="@DateTime.UtcNow.Year"
           class="flex items-center gap-3 p-4 rounded-xl border border-slate-200 hover:border-primary/30 hover:shadow-md transition-all group">
            <div class="size-10 rounded-lg bg-emerald-50 text-emerald-600 flex items-center justify-center group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined">event_available</span>
            </div>
            <div>
                <p class="font-bold text-sm text-slate-900 dark:text-white">Attendance &#8212; X-B</p>
                <p class="text-xs text-slate-500 dark:text-slate-400">Current month PDF</p>
            </div>
        </a>
        <a asp-area="" asp-controller="ReportDownload" asp-action="AttendanceReport" asp-route-classSectionId="1" asp-route-month="7" asp-route-year="2024"
           class="flex items-center gap-3 p-4 rounded-xl border border-slate-200 hover:border-primary/30 hover:shadow-md transition-all group">
            <div class="size-10 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined">event_available</span>
            </div>
            <div>
                <p class="font-bold text-sm text-slate-900 dark:text-white">Attendance &#8212; X-A (July 2024)</p>
                <p class="text-xs text-slate-500 dark:text-slate-400">With seed data records</p>
            </div>
        </a>
    </div>
</div>
